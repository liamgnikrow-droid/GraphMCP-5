from db_config import get_driver
import re

content = """# Определение Физики Графа (Законы Мира)

> Этот узел определяет Разрешенные Переходы и Доступность Инструментов в зависимости от Локации Агента.

## Механика (Глобальные Инструменты)

Эти инструменты доступны в **любом состоянии**, обеспечивая базовые функции восприятия и моторики Агента.

| Имя Инструмента | Описание | Ограничения |
| :--- | :--- | :--- |
| `look_around` | Чувство локации. Возвращает текущий узел и соседей. | Нет. |
| `read_graph` | Глубокое сканирование. Читает детальную структуру узла. | Нет. |
| `move_to` | Моторика. Перемещение к соседнему узлу. | Только к существующему соседу. |
| `look_for_similar` | Семантическая интуиция. Поиск узлов по смыслу. | Нет. |
| `sync_graph` | Системная функция. Принудительная синхронизация Neo4j -> Obsidian. | Нет. |
| `delete_node` | Деструктивная функция. Удаление узла и файла. | **Запрещено** удалять текущую локацию. |
| `delete_link` | Деструктивная функция. Удаление связи. | Требует валидные source/target. |
| `link_nodes` | Строительная функция. Связывание существующих узлов. | Строго по типам связей. |

## Переходы (Двери)

Правила переходов определяют, где могут появляться новые концепции. Это строго ограничивает инструмент `create_concept`.

| Тип Источника | Тип Цели | Тип Связи | Действие |
| :--- | :--- | :--- | :--- |
| **Idea** | **Spec** | `DECOMPOSES` | `create_concept(type='Spec')` |
| **Idea** | **Task** | `DECOMPOSES` | `create_concept(type='Task')` |
| **Spec** | **Requirement** | `DECOMPOSES` | `create_concept(type='Requirement')` |
| **Spec** | **Task** | `DECOMPOSES` | `create_concept(type='Task')` |
| **Requirement** | **Task** | `DECOMPOSES` | `create_concept(type='Task')` |
| **Task** | **Idea** | `DECOMPOSES` | `create_concept(type='Idea')` |
| **Domain** | **Idea** | `DECOMPOSES` | `create_concept(type='Idea')` |

## Ограничения (Белый Список)

Любое нарушение этих законов приводит к `PHYSICS ERROR` и блокировке действия.

### 1. Закон Чистых Ссылок (REQ-YAML_LINKS_ONLY)
*   **Запрещено**: Использование `[[WikiLinks]]` внутри свойств (заголовок, описание).
*   **Обязательно**: Все связи должны определяться через Структуру Графа (связи Neo4j), которые проецируются в YAML фронтматер Системой.

### 2. Закон Топологии
*   Нельзя удалять землю, на которой стоишь.
*   Нельзя создавать концепцию без валидного Родительского контекста (см. таблицу Переходов).

### 3. Закон Типов
*   Существуют только следующие Типы Узлов: `Idea`, `Spec`, `Requirement`, `Task`, `Domain`, `File`.
*   Тип `Epic` устарел и запрещен.

### 4. Закон Языка (REQ-Russian_Language)
*   **Обязательно**: Весь контент (Заголовки, Описания) должен быть на Русском языке.
*   **Исключение**: Технические термины (Docker, Neo4j, Python) допускаются на английском, но основной текст должен быть кириллическим.

---
*Обновлено: 2026-01-28 через Протокол Iron Dome*
"""

driver = get_driver()
with driver.session() as session:
    session.run("MATCH (n {uid: 'SPEC-Graph_Physics'}) SET n.content = $content, n.title = 'Определение Физики Графа'", content=content)
    
print("✅ SPEC-Graph_Physics переведен на Русский. Законы обновлены.")

from graph_sync import GraphSync
GraphSync().sync_node('SPEC-Graph_Physics')
