# Ограничения Безопасности Iron Dome (GraphMCP-5)

Этот документ перечисляет активные ограничения безопасности, наложенные на среду Агента.
Статус реализации помечен как:
*   [HARD] — Техническое ограничение (Docker, Code). Обойти невозможно.
*   [SOFT] — Организационное ограничение (Prompt, Tool Description). Требует соблюдения со стороны LLM.

## 1. Сетевая Изоляция (Docker)

*   **Frontend Network (`frontend-net`)**: [HARD]
    *   **Агент (IDE)**: Подключен сюда. Видит ТОЛЬКО `graphmcp-core:8000`.
    *   **Core (Сервер)**: Подключен сюда.
    *   **Ограничение**: Агент НЕ МОЖЕТ достучаться до `neo4j-db` (порты 7687, 7474 недоступны). Команда `curl neo4j-db:7474` выдаст ошибку.

*   **Backend Network (`backend-net`)**: [HARD]
    *   **Core (Сервер)**: Подключен сюда. Служит единственным мостом.
    *   **Neo4j (БД)**: Подключена сюда. Изолирована от Frontend сети.

## 2. Файловые Ограничения (Docker Volume Mounts)

*   **Root Workspace (`/workspace`)**: [HARD] **Только чтение (RO)**.
    *   Агент не может создавать, менять или удалять файлы в корне проекта.
    *   Попытка `touch /workspace/hack.txt` -> ошибка `Read-only file system`.

*   **Кодовая База (`/workspace/Tools`, `/workspace/Graph_Physics`)**: [HARD] **Только чтение (RO)**.
    *   Агент не может менять код своего сервера (`server.py`) или Законы Физики.

*   **Разрешенные Зоны Записи ("Дыры")**: [HARD]
    *   `/workspace/.graphmcp`: **RW** (Внутреннее состояние агента).
    *   `/home/node/.antigravity`: **RW** (Мозги/память агента).
    *   **ВАЖНО:** `/workspace/Graph_Export` теперь **RO** для Агента в `docker-compose.yml`. Только Core Сервер (у которого RW права) может создавать Markdown файлы по запросу через инструмент `create_concept`.

## 3. Прикладные Ограничения (MCP Middleware)

*   **Линза (Middleware)**: [HARD]
    *   Инструменты фильтруются динамически на основе местоположения Агента в графе.
    *   Правила читаются из ноды `SPEC-Graph_Physics` в Neo4j (или аварийного режима сервера).

*   **Белый Список Концептов (Строгий)**: [HARD]
    *   Разрешены ТОЛЬКО: `Idea`, `Spec`, `Requirement`, `Task`, `Domain`.
    *   Любые другие типы (например, `Epic`) запрещены автоматически через валидацию Enum на сервере.

*   **Белый Список Инструментов**: [HARD]
    *   LLM доступны только инструменты, явно возвращенные функцией `list_tools` для текущего контекста.
    *   Доступ к Bash (`run_command`) технически есть (мы не удаляли сам шелл), но он бесполезен для изменений системы (см. п. 1 и 2).

*   **Языковое Ограничение**: [HARD]
    *   Весь контент (названия нод, описания, документация) должен быть на русском языке.
    *   Реализовано технически: Сервер проверяет, что минимум 25% символов — кириллица. Попытка создать английский контент приведет к `PHYSICS ERROR`.

*   **Структурная Целостность**: [HARD]
    *   **Закон Чистых Ссылок**: Вики-ссылки `[[...]]` в тексте запрещены кодом сервера.
    *   **Закон Несущей Стены**: Запрещено удалять узлы, имеющие исходящие связи (детей).
    *   **Закон Пуповины**: Запрещено удалять единственную входящую связь для узла (избегание островов).
